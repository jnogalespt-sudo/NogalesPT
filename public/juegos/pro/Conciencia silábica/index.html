<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>CONCIENCIA SILÃBICA - NOGALESPT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap');
        
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f1f5f9;
            overflow-y: auto;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .menu-card {
            transition: all 0.2s ease;
        }
        .menu-card:active {
            transform: scale(0.98);
        }

        .syllable-card {
            touch-action: none;
            cursor: grab;
            z-index: 50;
        }

        .drop-zone-active {
            border-color: #a855f7 !important;
            background-color: #faf5ff !important;
            transform: scale(1.05);
        }

        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Estilo fiel al logo de la imagen */
        .logo-box {
            background-color: #6d9773;
            border-radius: 1.25rem;
        }
        .logo-text-nogales { color: #1e293b; }
        .logo-text-pt { color: #6d9773; }

        .report-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .report-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }
    </style>
</head>
<body class="min-h-screen py-4 px-2 sm:py-8 sm:px-4">

    <div id="main-app" class="max-w-md mx-auto bg-white rounded-[2.5rem] shadow-2xl border-[6px] border-purple-50 overflow-hidden relative min-h-[650px] flex flex-col">
        
        <!-- CABECERA FIEL AL LOGO -->
        <div class="p-6 bg-white border-b border-gray-100 flex flex-col items-center">
            <!-- Icono del Birrete -->
            <div class="w-16 h-16 logo-box flex items-center justify-center mb-2 shadow-sm">
                <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10">
                    <path d="M22 10v6M2 10l10-5 10 5-10 5-10 5-10 5z"/>
                    <path d="M6 12v5c3 3 9 3 12 0v-5"/>
                </svg>
            </div>
            <!-- Texto NOGALESPT -->
            <div class="text-3xl font-black flex items-baseline tracking-tighter">
                <span class="logo-text-nogales">NOGALES</span><span class="logo-text-pt">PT</span>
            </div>
            <h1 class="text-[10px] font-bold text-purple-400 tracking-[0.3em] uppercase mt-1">CONCIENCIA SILÃBICA</h1>
        </div>

        <!-- CONTENEDOR DINÃMICO -->
        <div id="view-container" class="flex-1 flex flex-col p-5">
            <!-- Cargado por JS -->
        </div>

    </div>

    <script>
        // BASE DE DATOS MANTENIDA (Mismo contenido previo de gameLibrary)
        const gameLibrary = {
            directas: {
                inicio: [
                    { word: "casa", emoji: "ğŸ ", syllables: ["ca", "sa"], targetIdx: 0, options: ["ca", "ka"] },
                    { word: "pato", emoji: "ğŸ¦†", syllables: ["pa", "to"], targetIdx: 0, options: ["pa", "ba"] },
                    { word: "mono", emoji: "ğŸ’", syllables: ["mo", "no"], targetIdx: 0, options: ["mo", "no"] },
                    { word: "luna", emoji: "ğŸŒ™", syllables: ["lu", "na"], targetIdx: 0, options: ["lu", "lo"] },
                    { word: "sapo", emoji: "ğŸ¸", syllables: ["sa", "po"], targetIdx: 0, options: ["sa", "za"] },
                    { word: "dedo", emoji: "â˜ï¸", syllables: ["de", "do"], targetIdx: 0, options: ["de", "be"] },
                    { word: "vaca", emoji: "ğŸ®", syllables: ["va", "ca"], targetIdx: 0, options: ["va", "ba"] },
                    { word: "gato", emoji: "ğŸ±", syllables: ["ga", "to"], targetIdx: 0, options: ["ga", "ja"] },
                    { word: "foca", emoji: "ğŸ¦­", syllables: ["fo", "ca"], targetIdx: 0, options: ["fo", "po"] },
                    { word: "nube", emoji: "â˜ï¸", syllables: ["nu", "be"], targetIdx: 0, options: ["nu", "mu"] },
                    { word: "pino", emoji: "ğŸŒ²", syllables: ["pi", "no"], targetIdx: 0, options: ["pi", "bi"] },
                    { word: "rosa", emoji: "ğŸŒ¹", syllables: ["ro", "sa"], targetIdx: 0, options: ["ro", "lo"] },
                    { word: "toro", emoji: "ğŸ‚", syllables: ["to", "ro"], targetIdx: 0, options: ["to", "do"] },
                    { word: "rana", emoji: "ğŸ¸", syllables: ["ra", "na"], targetIdx: 0, options: ["ra", "la"] },
                    { word: "pala", emoji: "ğŸ§¹", syllables: ["pa", "la"], targetIdx: 0, options: ["pa", "ta"] },
                    { word: "nido", emoji: "ğŸªº", syllables: ["ni", "do"], targetIdx: 0, options: ["ni", "mi"] },
                    { word: "bola", emoji: "âš½", syllables: ["bo", "la"], targetIdx: 0, options: ["bo", "po"] },
                    { word: "jarrÃ³n", emoji: "ğŸº", syllables: ["ja", "rrÃ³n"], targetIdx: 0, options: ["ja", "ga"] },
                    { word: "silla", emoji: "ğŸª‘", syllables: ["si", "lla"], targetIdx: 0, options: ["si", "zi"] },
                    { word: "piÃ±a", emoji: "ğŸ", syllables: ["pi", "Ã±a"], targetIdx: 0, options: ["pi", "bi"] }
                ],
                mitad: [
                    { word: "pelota", emoji: "âš½", syllables: ["pe", "lo", "ta"], targetIdx: 1, options: ["lo", "ro"] },
                    { word: "maleta", emoji: "ğŸ’¼", syllables: ["ma", "le", "ta"], targetIdx: 1, options: ["le", "de"] },
                    { word: "comida", emoji: "ğŸ½ï¸", syllables: ["co", "mi", "da"], targetIdx: 1, options: ["mi", "ni"] },
                    { word: "canica", emoji: "âšª", syllables: ["ca", "ni", "ca"], targetIdx: 1, options: ["ni", "mi"] },
                    { word: "paloma", emoji: "ğŸ•Šï¸", syllables: ["pa", "lo", "ma"], targetIdx: 1, options: ["lo", "ro"] },
                    { word: "basura", emoji: "ğŸ—‘ï¸", syllables: ["ba", "su", "ra"], targetIdx: 1, options: ["su", "zu"] },
                    { word: "cocina", emoji: "ğŸ³", syllables: ["co", "ci", "na"], targetIdx: 1, options: ["ci", "si"] },
                    { word: "madera", emoji: "ğŸªµ", syllables: ["ma", "de", "ra"], targetIdx: 1, options: ["de", "be"] },
                    { word: "tomate", emoji: "ğŸ…", syllables: ["to", "ma", "te"], targetIdx: 1, options: ["ma", "na"] },
                    { word: "raqueta", emoji: "ğŸ¾", syllables: ["ra", "que", "ta"], targetIdx: 1, options: ["que", "ke"] },
                    { word: "zapato", emoji: "ğŸ‘Ÿ", syllables: ["za", "pa", "to"], targetIdx: 1, options: ["pa", "ba"] },
                    { word: "abanico", emoji: "ğŸª­", syllables: ["a", "ba", "ni", "co"], targetIdx: 2, options: ["ni", "mi"] },
                    { word: "corona", emoji: "ğŸ‘‘", syllables: ["co", "ro", "na"], targetIdx: 1, options: ["ro", "lo"] },
                    { word: "pecera", emoji: "ğŸ¥£", syllables: ["pe", "ce", "ra"], targetIdx: 1, options: ["ce", "se"] },
                    { word: "jirafa", emoji: "ğŸ¦’", syllables: ["ji", "ra", "fa"], targetIdx: 1, options: ["ra", "la"] },
                    { word: "pepino", emoji: "ğŸ¥’", syllables: ["pe", "pi", "no"], targetIdx: 1, options: ["pi", "bi"] },
                    { word: "conejo", emoji: "ğŸ‡", syllables: ["co", "ne", "jo"], targetIdx: 1, options: ["ne", "me"] },
                    { word: "camino", emoji: "ğŸ›£ï¸", syllables: ["ca", "mi", "no"], targetIdx: 1, options: ["mi", "ni"] },
                    { word: "regalo", emoji: "ğŸ", syllables: ["re", "ga", "lo"], targetIdx: 1, options: ["ga", "ja"] },
                    { word: "capote", emoji: "ğŸ§¥", syllables: ["ca", "po", "te"], targetIdx: 1, options: ["po", "bo"] }
                ],
                final: [
                    { word: "bota", emoji: "ğŸ¥¾", syllables: ["bo", "ta"], targetIdx: 1, options: ["ta", "da"] },
                    { word: "luna", emoji: "ğŸŒ™", syllables: ["lu", "na"], targetIdx: 1, options: ["na", "ma"] },
                    { word: "gato", emoji: "ğŸ±", syllables: ["ga", "to"], targetIdx: 1, options: ["to", "do"] },
                    { word: "sapo", emoji: "ğŸ¸", syllables: ["sa", "po"], targetIdx: 1, options: ["po", "bo"] },
                    { word: "vaca", emoji: "ğŸ®", syllables: ["va", "ca"], targetIdx: 1, options: ["ca", "ga"] },
                    { word: "dedo", emoji: "â˜ï¸", syllables: ["de", "do"], targetIdx: 1, options: ["do", "bo"] },
                    { word: "piÃ±a", emoji: "ğŸ", syllables: ["pi", "Ã±a"], targetIdx: 1, options: ["Ã±a", "ma"] },
                    { word: "rosa", emoji: "ğŸŒ¹", syllables: ["ro", "sa"], targetIdx: 1, options: ["sa", "za"] },
                    { word: "bola", emoji: "âš½", syllables: ["bo", "la"], targetIdx: 1, options: ["la", "ra"] },
                    { word: "pala", emoji: "ğŸ§¹", syllables: ["pa", "la"], targetIdx: 1, options: ["la", "na"] },
                    { word: "nube", emoji: "â˜ï¸", syllables: ["nu", "be"], targetIdx: 1, options: ["be", "pe"] },
                    { word: "pera", emoji: "ğŸ", syllables: ["pe", "ra"], targetIdx: 1, options: ["ra", "la"] },
                    { word: "lobo", emoji: "ğŸº", syllables: ["lo", "bo"], targetIdx: 1, options: ["bo", "po"] },
                    { word: "toro", emoji: "ğŸ‚", syllables: ["to", "ro"], targetIdx: 1, options: ["ro", "lo"] },
                    { word: "foca", emoji: "ğŸ¦­", syllables: ["fo", "ca"], targetIdx: 1, options: ["ca", "ka"] },
                    { word: "mesa", emoji: "ğŸª‘", syllables: ["me", "sa"], targetIdx: 1, options: ["sa", "za"] },
                    { word: "casa", emoji: "ğŸ ", syllables: ["ca", "sa"], targetIdx: 1, options: ["sa", "za"] },
                    { word: "moto", emoji: "ğŸï¸", syllables: ["mo", "to"], targetIdx: 1, options: ["to", "do"] },
                    { word: "rana", emoji: "ğŸ¸", syllables: ["ra", "na"], targetIdx: 1, options: ["na", "la"] },
                    { word: "copa", emoji: "ğŸ·", syllables: ["co", "pa"], targetIdx: 1, options: ["pa", "ba"] }
                ]
            },
            inversas: {
                inicio: [
                    { word: "Ã¡rbol", emoji: "ğŸŒ³", syllables: ["Ã¡r", "bol"], targetIdx: 0, options: ["Ã¡r", "ra"] },
                    { word: "isla", emoji: "ğŸï¸", syllables: ["is", "la"], targetIdx: 0, options: ["is", "si"] },
                    { word: "espejo", emoji: "ğŸª", syllables: ["es", "pe", "jo"], targetIdx: 0, options: ["es", "se"] },
                    { word: "antena", emoji: "ğŸ“¡", syllables: ["an", "te", "na"], targetIdx: 0, options: ["an", "na"] },
                    { word: "indio", emoji: "ğŸ¹", syllables: ["in", "dio"], targetIdx: 0, options: ["in", "ni"] },
                    { word: "escoba", emoji: "ğŸ§¹", syllables: ["es", "co", "ba"], targetIdx: 0, options: ["es", "se"] },
                    { word: "Ã¡ngel", emoji: "ğŸ‘¼", syllables: ["Ã¡n", "gel"], targetIdx: 0, options: ["Ã¡n", "na"] },
                    { word: "arco", emoji: "ğŸ¹", syllables: ["ar", "co"], targetIdx: 0, options: ["ar", "ra"] },
                    { word: "elfo", emoji: "ğŸ§", syllables: ["el", "fo"], targetIdx: 0, options: ["el", "le"] },
                    { word: "iglÃº", emoji: "ğŸ§Š", syllables: ["ig", "lÃº"], targetIdx: 0, options: ["ig", "gi"] },
                    { word: "olla", emoji: "ğŸ²", syllables: ["o", "lla"], targetIdx: 0, options: ["o", "u"] },
                    { word: "aspa", emoji: "âœ–ï¸", syllables: ["as", "pa"], targetIdx: 0, options: ["as", "sa"] },
                    { word: "imÃ¡n", emoji: "ğŸ§²", syllables: ["i", "mÃ¡n"], targetIdx: 0, options: ["i", "e"] },
                    { word: "urna", emoji: "ğŸ—³ï¸", syllables: ["ur", "na"], targetIdx: 0, options: ["ur", "ru"] },
                    { word: "enano", emoji: "ğŸ„", syllables: ["e", "na", "no"], targetIdx: 0, options: ["e", "a"] },
                    { word: "ojo", emoji: "ğŸ‘ï¸", syllables: ["o", "jo"], targetIdx: 0, options: ["o", "i"] },
                    { word: "uva", emoji: "ğŸ‡", syllables: ["u", "va"], targetIdx: 0, options: ["u", "o"] },
                    { word: "oso", emoji: "ğŸ»", syllables: ["o", "so"], targetIdx: 0, options: ["o", "e"] },
                    { word: "espÃ­a", emoji: "ğŸ•µï¸", syllables: ["es", "pÃ­", "a"], targetIdx: 0, options: ["es", "se"] },
                    { word: "alto", emoji: "â¬†ï¸", syllables: ["al", "to"], targetIdx: 0, options: ["al", "la"] }
                ],
                mitad: [
                    { word: "antorcha", emoji: "ğŸ”¦", syllables: ["an", "tor", "cha"], targetIdx: 1, options: ["tor", "tro"] },
                    { word: "ventana", emoji: "ğŸªŸ", syllables: ["ven", "ta", "na"], targetIdx: 0, options: ["ven", "ne"] },
                    { word: "martillo", emoji: "ğŸ”¨", syllables: ["mar", "ti", "llo"], targetIdx: 0, options: ["mar", "ram"] },
                    { word: "pincel", emoji: "ğŸ–Œï¸", syllables: ["pin", "cel"], targetIdx: 1, options: ["cel", "ce"] },
                    { word: "castillo", emoji: "ğŸ°", syllables: ["cas", "ti", "llo"], targetIdx: 0, options: ["cas", "sac"] },
                    { word: "serpiente", emoji: "ğŸ", syllables: ["ser", "pien", "te"], targetIdx: 0, options: ["ser", "res"] },
                    { word: "montaÃ±a", emoji: "â›°ï¸", syllables: ["mon", "ta", "Ã±a"], targetIdx: 0, options: ["mon", "nom"] },
                    { word: "bufanda", emoji: "ğŸ§£", syllables: ["bu", "fan", "da"], targetIdx: 1, options: ["fan", "naf"] },
                    { word: "pintura", emoji: "ğŸ¨", syllables: ["pin", "tu", "ra"], targetIdx: 0, options: ["pin", "nip"] },
                    { word: "volcÃ¡n", emoji: "ğŸŒ‹", syllables: ["vol", "cÃ¡n"], targetIdx: 0, options: ["vol", "lov"] },
                    { word: "sandÃ­a", emoji: "ğŸ‰", syllables: ["san", "dÃ­", "a"], targetIdx: 0, options: ["san", "nas"] },
                    { word: "duende", emoji: "ğŸ§š", syllables: ["duen", "de"], targetIdx: 0, options: ["duen", "den"] },
                    { word: "fuente", emoji: "â›²", syllables: ["fuen", "te"], targetIdx: 0, options: ["fuen", "nef"] },
                    { word: "diente", emoji: "ğŸ¦·", syllables: ["dien", "te"], targetIdx: 0, options: ["dien", "ned"] },
                    { word: "puente", emoji: "ğŸŒ‰", syllables: ["puen", "te"], targetIdx: 0, options: ["puen", "nep"] },
                    { word: "espada", emoji: "âš”ï¸", syllables: ["es", "pa", "da"], targetIdx: 0, options: ["es", "se"] },
                    { word: "alfombra", emoji: "ğŸ§¶", syllables: ["al", "fom", "bra"], targetIdx: 1, options: ["fom", "mof"] },
                    { word: "perla", emoji: "ğŸ¦ª", syllables: ["per", "la"], targetIdx: 0, options: ["per", "pre"] },
                    { word: "barco", emoji: "ğŸš¢", syllables: ["bar", "co"], targetIdx: 0, options: ["bar", "bra"] },
                    { word: "selva", emoji: "ğŸŒ¿", syllables: ["sel", "va"], targetIdx: 0, options: ["sel", "les"] }
                ],
                final: [
                    { word: "tambor", emoji: "ğŸ¥", syllables: ["tam", "bor"], targetIdx: 1, options: ["bor", "bro"] },
                    { word: "pastel", emoji: "ğŸ°", syllables: ["pas", "tel"], targetIdx: 1, options: ["tel", "tle"] },
                    { word: "papel", emoji: "ğŸ“„", syllables: ["pa", "pel"], targetIdx: 1, options: ["pel", "ple"] },
                    { word: "ratÃ³n", emoji: "ğŸ­", syllables: ["ra", "tÃ³n"], targetIdx: 1, options: ["tÃ³n", "not"] },
                    { word: "limÃ³n", emoji: "ğŸ‹", syllables: ["li", "mÃ³n"], targetIdx: 1, options: ["mÃ³n", "nom"] },
                    { word: "melÃ³n", emoji: "ğŸˆ", syllables: ["me", "lÃ³n"], targetIdx: 1, options: ["lÃ³n", "nol"] },
                    { word: "balcÃ³n", emoji: "ğŸ™ï¸", syllables: ["bal", "cÃ³n"], targetIdx: 1, options: ["cÃ³n", "noc"] },
                    { word: "botÃ³n", emoji: "ğŸ”˜", syllables: ["bo", "tÃ³n"], targetIdx: 1, options: ["tÃ³n", "not"] },
                    { word: "aviÃ³n", emoji: "âœˆï¸", syllables: ["a", "viÃ³n"], targetIdx: 1, options: ["viÃ³n", "niv"] },
                    { word: "camiÃ³n", emoji: "ğŸšš", syllables: ["ca", "miÃ³n"], targetIdx: 1, options: ["miÃ³n", "nim"] },
                    { word: "jamÃ³n", emoji: "ğŸ–", syllables: ["ja", "mÃ³n"], targetIdx: 1, options: ["mÃ³n", "nom"] },
                    { word: "jabÃ³n", emoji: "ğŸ§¼", syllables: ["ja", "bÃ³n"], targetIdx: 1, options: ["bÃ³n", "nob"] },
                    { word: "sillÃ³n", emoji: "ğŸ›‹ï¸", syllables: ["si", "llÃ³n"], targetIdx: 1, options: ["llÃ³n", "nol"] },
                    { word: "bastÃ³n", emoji: "ğŸ¦¯", syllables: ["bas", "tÃ³n"], targetIdx: 1, options: ["tÃ³n", "not"] },
                    { word: "delfÃ­n", emoji: "ğŸ¬", syllables: ["del", "fÃ­n"], targetIdx: 1, options: ["fÃ­n", "nif"] },
                    { word: "jardÃ­n", emoji: "ğŸ¡", syllables: ["jar", "dÃ­n"], targetIdx: 1, options: ["dÃ­n", "nid"] },
                    { word: "patÃ­n", emoji: "ğŸ›¼", syllables: ["pa", "tÃ­n"], targetIdx: 1, options: ["tÃ­n", "nit"] },
                    { word: "pantalÃ³n", emoji: "ğŸ‘–", syllables: ["pan", "ta", "lÃ³n"], targetIdx: 2, options: ["lÃ³n", "nol"] },
                    { word: "dormir", emoji: "ğŸ’¤", syllables: ["dor", "mir"], targetIdx: 1, options: ["mir", "rim"] },
                    { word: "comer", emoji: "ğŸ´", syllables: ["co", "mer"], targetIdx: 1, options: ["mer", "rem"] }
                ]
            },
            trabadas: {
                inicio: [
                    { word: "brazo", emoji: "ğŸ’ª", syllables: ["bra", "zo"], targetIdx: 0, options: ["bra", "bar"] },
                    { word: "globo", emoji: "ğŸˆ", syllables: ["glo", "bo"], targetIdx: 0, options: ["glo", "gol"] },
                    { word: "tren", emoji: "ğŸš‚", syllables: ["tren"], targetIdx: 0, options: ["tren", "ter"] },
                    { word: "fresa", emoji: "ğŸ“", syllables: ["fre", "sa"], targetIdx: 0, options: ["fre", "fer"] },
                    { word: "grifo", emoji: "ğŸš°", syllables: ["gri", "fo"], targetIdx: 0, options: ["gri", "gir"] },
                    { word: "plato", emoji: "ğŸ½ï¸", syllables: ["pla", "to"], targetIdx: 0, options: ["pla", "pal"] },
                    { word: "bruja", emoji: "ğŸ§™", syllables: ["bru", "ja"], targetIdx: 0, options: ["bru", "bur"] },
                    { word: "clavo", emoji: "ğŸ”¨", syllables: ["cla", "vo"], targetIdx: 0, options: ["cla", "cal"] },
                    { word: "dragÃ³n", emoji: "ğŸ²", syllables: ["dra", "gÃ³n"], targetIdx: 0, options: ["dra", "dar"] },
                    { word: "fruta", emoji: "ğŸ", syllables: ["fru", "ta"], targetIdx: 0, options: ["fru", "fur"] },
                    { word: "granja", emoji: "ğŸšœ", syllables: ["gran", "ja"], targetIdx: 0, options: ["gran", "gar"] },
                    { word: "preso", emoji: "â›“ï¸", syllables: ["pre", "so"], targetIdx: 0, options: ["pre", "per"] },
                    { word: "trino", emoji: "ğŸ¦", syllables: ["tri", "no"], targetIdx: 0, options: ["tri", "tir"] },
                    { word: "blanco", emoji: "âšª", syllables: ["blan", "co"], targetIdx: 0, options: ["blan", "bal"] },
                    { word: "flaco", emoji: "ğŸ¦´", syllables: ["fla", "co"], targetIdx: 0, options: ["fla", "fal"] },
                    { word: "gloria", emoji: "ğŸ†", syllables: ["glo", "ria"], targetIdx: 0, options: ["glo", "gol"] },
                    { word: "pluma", emoji: "ğŸª¶", syllables: ["plu", "ma"], targetIdx: 0, options: ["plu", "pul"] },
                    { word: "crema", emoji: "ğŸ§´", syllables: ["cre", "ma"], targetIdx: 0, options: ["cre", "cer"] },
                    { word: "cruz", emoji: "âœï¸", syllables: ["cruz"], targetIdx: 0, options: ["cruz", "curz"] },
                    { word: "flecha", emoji: "ğŸ¹", syllables: ["fle", "cha"], targetIdx: 0, options: ["fle", "fel"] }
                ],
                mitad: [
                    { word: "libreta", emoji: "ğŸ““", syllables: ["li", "bre", "ta"], targetIdx: 1, options: ["bre", "ber"] },
                    { word: "estrella", emoji: "â­", syllables: ["es", "tre", "lla"], targetIdx: 1, options: ["tre", "ter"] },
                    { word: "escribir", emoji: "âœï¸", syllables: ["es", "cri", "bir"], targetIdx: 1, options: ["cri", "cir"] },
                    { word: "ombligo", emoji: "ğŸ”˜", syllables: ["om", "bli", "go"], targetIdx: 1, options: ["bli", "bil"] },
                    { word: "sobrino", emoji: "ğŸ§’", syllables: ["so", "bri", "no"], targetIdx: 1, options: ["bri", "bir"] },
                    { word: "madrina", emoji: "âœ¨", syllables: ["ma", "dri", "na"], targetIdx: 1, options: ["dri", "dir"] },
                    { word: "padrino", emoji: "ğŸ¤µ", syllables: ["pa", "dri", "no"], targetIdx: 1, options: ["dri", "dir"] },
                    { word: "refresco", emoji: "ğŸ¥¤", syllables: ["re", "fres", "co"], targetIdx: 1, options: ["fres", "fers"] },
                    { word: "recreo", emoji: "ğŸ›", syllables: ["re", "cre", "o"], targetIdx: 1, options: ["cre", "cer"] },
                    { word: "sorpresa", emoji: "ğŸ‰", syllables: ["sor", "pre", "sa"], targetIdx: 1, options: ["pre", "per"] },
                    { word: "vinagre", emoji: "ğŸ§ª", syllables: ["vi", "na", "gre"], targetIdx: 2, options: ["gre", "ger"] },
                    { word: "potrero", emoji: "ğŸ", syllables: ["po", "tre", "ro"], targetIdx: 1, options: ["tre", "ter"] },
                    { word: "tablero", emoji: "ğŸ", syllables: ["ta", "ble", "ro"], targetIdx: 1, options: ["ta", "ble"] },
                    { word: "granizo", emoji: "ğŸŒ¨ï¸", syllables: ["gra", "ni", "zo"], targetIdx: 0, options: ["gra", "gar"] },
                    { word: "abrazo", emoji: "ğŸ«‚", syllables: ["a", "bra", "zo"], targetIdx: 1, options: ["bra", "bar"] },
                    { word: "refrÃ¡n", emoji: "ğŸ“œ", syllables: ["re", "frÃ¡n"], targetIdx: 1, options: ["frÃ¡n", "far"] },
                    { word: "aplauso", emoji: "ğŸ‘", syllables: ["a", "plau", "so"], targetIdx: 1, options: ["plau", "pal"] },
                    { word: "ciclista", emoji: "ğŸš´", syllables: ["ci", "clis", "ta"], targetIdx: 1, options: ["clis", "cal"] },
                    { word: "soplar", emoji: "ğŸŒ¬ï¸", syllables: ["so", "plar"], targetIdx: 1, options: ["plar", "pal"] },
                    { word: "copla", emoji: "ğŸ¶", syllables: ["co", "pla"], targetIdx: 1, options: ["pla", "pal"] }
                ],
                final: [
                    { word: "tigre", emoji: "ğŸ¯", syllables: ["ti", "gre"], targetIdx: 1, options: ["gre", "ger"] },
                    { word: "cofre", emoji: "ğŸ´â€â˜ ï¸", syllables: ["co", "fre"], targetIdx: 1, options: ["fre", "fer"] },
                    { word: "sobre", emoji: "âœ‰ï¸", syllables: ["so", "bre"], targetIdx: 1, options: ["bre", "ber"] },
                    { word: "cabra", emoji: "ğŸ", syllables: ["ca", "bra"], targetIdx: 1, options: ["bra", "bar"] },
                    { word: "cebra", emoji: "ğŸ¦“", syllables: ["ce", "bra"], targetIdx: 1, options: ["bra", "bar"] },
                    { word: "madre", emoji: "ğŸ‘©", syllables: ["ma", "dre"], targetIdx: 1, options: ["dre", "der"] },
                    { word: "padre", emoji: "ğŸ‘¨", syllables: ["pa", "dre"], targetIdx: 1, options: ["dre", "der"] },
                    { word: "sangre", emoji: "ğŸ©¸", syllables: ["san", "gre"], targetIdx: 1, options: ["gre", "ger"] },
                    { word: "mugre", emoji: "ğŸ§¼", syllables: ["mu", "gre"], targetIdx: 1, options: ["gre", "ger"] },
                    { word: "pupitre", emoji: "ğŸª‘", syllables: ["pu", "pi", "tre"], targetIdx: 2, options: ["tre", "ter"] },
                    { word: "sastre", emoji: "ğŸ§µ", syllables: ["sas", "tre"], targetIdx: 1, options: ["tre", "ter"] },
                    { word: "postre", emoji: "ğŸ°", syllables: ["pos", "tre"], targetIdx: 1, options: ["tre", "ter"] },
                    { word: "buitre", emoji: "ğŸ¦…", syllables: ["bui", "tre"], targetIdx: 1, options: ["tre", "ter"] },
                    { word: "liebre", emoji: "ğŸ‡", syllables: ["lie", "bre"], targetIdx: 1, options: ["bre", "ber"] },
                    { word: "cobre", emoji: "ğŸ¥‰", syllables: ["co", "bre"], targetIdx: 1, options: ["bre", "ber"] },
                    { word: "soplo", emoji: "ğŸŒ¬ï¸", syllables: ["so", "plo"], targetIdx: 1, options: ["plo", "pol"] },
                    { word: "acople", emoji: "ğŸ”Œ", syllables: ["a", "co", "ple"], targetIdx: 2, options: ["ple", "pel"] },
                    { word: "noble", emoji: "ğŸ‘‘", syllables: ["no", "ble"], targetIdx: 1, options: ["ble", "bel"] },
                    { word: "cable", emoji: "ğŸ”Œ", syllables: ["ca", "ble"], targetIdx: 1, options: ["ble", "bel"] },
                    { word: "mueble", emoji: "ğŸ›ï¸", syllables: ["mue", "ble"], targetIdx: 1, options: ["ble", "bel"] }
                ]
            },
            mixtas: {
                inicio: [
                    { word: "barco", emoji: "ğŸš¢", syllables: ["bar", "co"], targetIdx: 0, options: ["bar", "bra"] },
                    { word: "tarta", emoji: "ğŸ‚", syllables: ["tar", "ta"], targetIdx: 0, options: ["tar", "tra"] },
                    { word: "selva", emoji: "ğŸŒ¿", syllables: ["sel", "va"], targetIdx: 0, options: ["sel", "les"] },
                    { word: "carpa", emoji: "â›º", syllables: ["car", "pa"], targetIdx: 0, options: ["car", "cra"] },
                    { word: "cerdo", emoji: "ğŸ·", syllables: ["cer", "do"], targetIdx: 0, options: ["cer", "cre"] },
                    { word: "dardo", emoji: "ğŸ¯", syllables: ["dar", "do"], targetIdx: 0, options: ["dar", "dra"] },
                    { word: "gordo", emoji: "ğŸ”", syllables: ["gor", "do"], targetIdx: 0, options: ["gor", "gro"] },
                    { word: "norma", emoji: "ğŸ“œ", syllables: ["nor", "ma"], targetIdx: 0, options: ["nor", "ron"] },
                    { word: "pardo", emoji: "ğŸ»", syllables: ["par", "do"], targetIdx: 0, options: ["par", "pra"] },
                    { word: "verde", emoji: "ğŸ’š", syllables: ["ver", "de"], targetIdx: 0, options: ["ver", "vre"] },
                    { word: "corto", emoji: "âœ‚ï¸", syllables: ["cor", "to"], targetIdx: 0, options: ["cor", "cro"] },
                    { word: "largo", emoji: "ğŸ“", syllables: ["lar", "go"], targetIdx: 0, options: ["lar", "ral"] },
                    { word: "burla", emoji: "ğŸ˜œ", syllables: ["bur", "la"], targetIdx: 0, options: ["bur", "bru"] },
                    { word: "forma", emoji: "ğŸ“¦", syllables: ["for", "ma"], targetIdx: 0, options: ["for", "fro"] },
                    { word: "manta", emoji: "ğŸ›Œ", syllables: ["man", "ta"], targetIdx: 0, options: ["man", "nam"] },
                    { word: "canto", emoji: "ğŸ¤", syllables: ["can", "to"], targetIdx: 0, options: ["can", "nac"] },
                    { word: "punto", emoji: "ğŸ“", syllables: ["pun", "to"], targetIdx: 0, options: ["pun", "pnu"] },
                    { word: "bolso", emoji: "ğŸ‘œ", syllables: ["bol", "so"], targetIdx: 0, options: ["bol", "blo"] },
                    { word: "culto", emoji: "ğŸ›ï¸", syllables: ["cul", "to"], targetIdx: 0, options: ["cul", "clu"] },
                    { word: "bulto", emoji: "ğŸ’", syllables: ["bul", "to"], targetIdx: 0, options: ["bul", "blu"] }
                ],
                mitad: [
                    { word: "elefante", emoji: "ğŸ˜", syllables: ["e", "le", "fan", "te"], targetIdx: 2, options: ["fan", "fa"] },
                    { word: "contento", emoji: "ğŸ˜Š", syllables: ["con", "ten", "to"], targetIdx: 1, options: ["ten", "net"] },
                    { word: "descansar", emoji: "ğŸ˜´", syllables: ["des", "can", "sar"], targetIdx: 1, options: ["can", "acn"] },
                    { word: "manzana", emoji: "ğŸ", syllables: ["man", "za", "na"], targetIdx: 0, options: ["man", "na"] },
                    { word: "ventana", emoji: "ğŸªŸ", syllables: ["ven", "ta", "na"], targetIdx: 0, options: ["ven", "ne"] },
                    { word: "garganta", emoji: "ğŸ§£", syllables: ["gar", "gan", "ta"], targetIdx: 1, options: ["gan", "na"] },
                    { word: "serpiente", emoji: "ğŸ", syllables: ["ser", "pien", "te"], targetIdx: 1, options: ["pien", "pe"] },
                    { word: "bufanda", emoji: "ğŸ§£", syllables: ["bu", "fan", "da"], targetIdx: 1, options: ["fan", "fa"] },
                    { word: "pintura", emoji: "ğŸ¨", syllables: ["pin", "tu", "ra"], targetIdx: 0, options: ["pin", "pi"] },
                    { word: "lÃ¡mpara", emoji: "ğŸ’¡", syllables: ["lÃ¡m", "pa", "ra"], targetIdx: 0, options: ["lÃ¡m", "la"] },
                    { word: "cÃ¡scara", emoji: "ğŸŒ", syllables: ["cÃ¡s", "ca", "ra"], targetIdx: 0, options: ["cÃ¡s", "ca"] },
                    { word: "mÃ¡scara", emoji: "ğŸ­", syllables: ["mÃ¡s", "ca", "ra"], targetIdx: 0, options: ["mÃ¡s", "ma"] },
                    { word: "fÃ³sforo", emoji: "ğŸ”¥", syllables: ["fÃ³s", "fo", "ro"], targetIdx: 0, options: ["fÃ³s", "fo"] },
                    { word: "cÃ¡ntaro", emoji: "ğŸº", syllables: ["cÃ¡n", "ta", "ro"], targetIdx: 0, options: ["cÃ¡n", "ca"] },
                    { word: "paraguas", emoji: "â˜‚ï¸", syllables: ["pa", "ra", "guas"], targetIdx: 2, options: ["guas", "gu"] },
                    { word: "pimiento", emoji: "ğŸ«‘", syllables: ["pi", "mien", "to"], targetIdx: 1, options: ["pi", "mi"] },
                    { word: "invierno", emoji: "â„ï¸", syllables: ["in", "vier", "no"], targetIdx: 1, options: ["vier", "vi"] },
                    { word: "estante", emoji: "ğŸ“š", syllables: ["es", "tan", "te"], targetIdx: 1, options: ["tan", "ta"] },
                    { word: "volante", emoji: "ğŸ¡", syllables: ["vo", "lan", "te"], targetIdx: 1, options: ["lan", "la"] },
                    { word: "picante", emoji: "ğŸŒ¶ï¸", syllables: ["pi", "can", "te"], targetIdx: 1, options: ["can", "ca"] }
                ],
                final: [
                    { word: "pincel", emoji: "ğŸ–Œï¸", syllables: ["pin", "cel"], targetIdx: 1, options: ["cel", "cle"] },
                    { word: "tambor", emoji: "ğŸ¥", syllables: ["tam", "bor"], targetIdx: 1, options: ["bor", "bro"] },
                    { word: "pastor", emoji: "ğŸ‘", syllables: ["pas", "tor"], targetIdx: 1, options: ["tor", "tro"] },
                    { word: "carril", emoji: "ğŸ›¤ï¸", syllables: ["ca", "rril"], targetIdx: 1, options: ["rril", "rli"] },
                    { word: "barril", emoji: "ğŸ›¢ï¸", syllables: ["ba", "rril"], targetIdx: 1, options: ["rril", "rli"] },
                    { word: "motor", emoji: "âš™ï¸", syllables: ["mo", "tor"], targetIdx: 1, options: ["tor", "tro"] },
                    { word: "color", emoji: "ğŸŒˆ", syllables: ["co", "lor"], targetIdx: 1, options: ["lor", "lro"] },
                    { word: "valor", emoji: "ğŸ’", syllables: ["va", "lor"], targetIdx: 1, options: ["lor", "lro"] },
                    { word: "calor", emoji: "ğŸŒ¡ï¸", syllables: ["ca", "lor"], targetIdx: 1, options: ["lor", "lro"] },
                    { word: "sabor", emoji: "ğŸ‘…", syllables: ["sa", "bor"], targetIdx: 1, options: ["bor", "bro"] },
                    { word: "labor", emoji: "ğŸ‘·", syllables: ["la", "bor"], targetIdx: 1, options: ["bor", "bro"] },
                    { word: "favor", emoji: "ğŸ™", syllables: ["fa", "vor"], targetIdx: 1, options: ["vor", "vro"] },
                    { word: "tenor", emoji: "ğŸ‘¨â€ğŸ¤", syllables: ["te", "nor"], targetIdx: 1, options: ["nor", "nro"] },
                    { word: "vapor", emoji: "ğŸ’¨", syllables: ["va", "por"], targetIdx: 1, options: ["por", "pro"] },
                    { word: "sudor", emoji: "ğŸ’¦", syllables: ["su", "dor"], targetIdx: 1, options: ["dor", "dro"] },
                    { word: "rigor", emoji: "ğŸ“", syllables: ["ri", "gor"], targetIdx: 1, options: ["gor", "gro"] },
                    { word: "humor", emoji: "ğŸ¤¡", syllables: ["hu", "mor"], targetIdx: 1, options: ["mor", "mro"] },
                    { word: "temor", emoji: "ğŸ˜¨", syllables: ["te", "mor"], targetIdx: 1, options: ["mor", "mro"] },
                    { word: "honor", emoji: "ğŸ–ï¸", syllables: ["ho", "nor"], targetIdx: 1, options: ["nor", "nro"] },
                    { word: "pastor", emoji: "âœï¸", syllables: ["pas", "tor"], targetIdx: 1, options: ["tor", "tro"] }
                ]
            }
        };

        let currentCategory = "";
        let currentPosition = "";
        let currentLevel = 0;
        let dragItem = null;
        let offset = { x: 0, y: 0 };
        
        let studentName = "";
        let sessionErrors = []; 

        const viewContainer = document.getElementById('view-container');

        // --- SISTEMA DE VOZ ---
        function hablar(texto, cancelar = true) {
            if ('speechSynthesis' in window) {
                if (cancelar) window.speechSynthesis.cancel();
                const msg = new SpeechSynthesisUtterance(texto);
                msg.lang = 'es-ES';
                msg.rate = 0.85;
                msg.pitch = 1.1;
                window.speechSynthesis.speak(msg);
            }
        }

        // --- VISTAS ---

        function showLogin() {
            viewContainer.innerHTML = `
                <div class="fade-in space-y-6 flex flex-col items-center">
                    <p class="text-gray-500 font-bold text-center">Â¡Hola! Escribe el nombre del alumno para empezar:</p>
                    <input id="student-name-input" type="text" placeholder="Escribe el nombre aquÃ­" class="w-full p-4 bg-gray-50 rounded-2xl border-2 border-purple-100 text-center text-xl font-bold outline-none focus:border-purple-400">
                    <button onclick="saveName()" class="w-full py-4 bg-purple-600 text-white rounded-2xl font-bold text-xl shadow-lg hover:bg-purple-700 transition-colors">Entrar</button>
                </div>
            `;
            setTimeout(() => document.getElementById('student-name-input').focus(), 100);
        }

        function saveName() {
            const name = document.getElementById('student-name-input').value.trim();
            if(!name) { hablar("Por favor, escribe el nombre."); return; }
            studentName = name;
            hablar("Hola " + name);
            showMainMenu();
        }

        function showMainMenu() {
            viewContainer.innerHTML = `
                <div class="fade-in space-y-3">
                    <p class="text-center text-gray-400 font-bold mb-4 text-xs tracking-widest uppercase">Alumno: ${studentName}</p>
                    <button onclick="selectCategory('directas')" class="menu-card w-full p-5 bg-blue-500 text-white rounded-3xl font-bold text-lg shadow-md flex items-center justify-between">
                        <span>Directas (CV)</span>
                        <span class="text-xl">â”</span>
                    </button>
                    <button onclick="selectCategory('inversas')" class="menu-card w-full p-5 bg-emerald-500 text-white rounded-3xl font-bold text-lg shadow-md flex items-center justify-between">
                        <span>Inversas (VC)</span>
                        <span class="text-xl">â”</span>
                    </button>
                    <button onclick="selectCategory('trabadas')" class="menu-card w-full p-5 bg-purple-500 text-white rounded-3xl font-bold text-lg shadow-md flex items-center justify-between">
                        <span>Trabadas (CCV)</span>
                        <span class="text-xl">â”</span>
                    </button>
                    <button onclick="selectCategory('mixtas')" class="menu-card w-full p-5 bg-orange-500 text-white rounded-3xl font-bold text-lg shadow-md flex items-center justify-between">
                        <span>Mixtas (CVC)</span>
                        <span class="text-xl">â”</span>
                    </button>

                    <button onclick="showLogin()" class="w-full py-3 mt-4 text-gray-400 font-bold text-sm underline">Cambiar de alumno</button>
                </div>
            `;
        }

        function selectCategory(cat) {
            currentCategory = cat;
            hablar(cat);
            showPositionMenu();
        }

        function showPositionMenu() {
            viewContainer.innerHTML = `
                <div class="fade-in space-y-4">
                    <button onclick="showMainMenu()" class="text-gray-400 font-bold text-xs mb-4 uppercase tracking-tighter">â† Volver al menÃº</button>
                    <p class="text-center text-gray-500 font-bold mb-6 uppercase tracking-tight text-sm">Â¿En quÃ© parte de la palabra?</p>
                    <button onclick="startMode('inicio')" class="menu-card w-full p-6 bg-white border-2 border-gray-100 text-slate-700 rounded-3xl font-bold text-xl hover:border-blue-400 transition-colors">Al inicio</button>
                    <button onclick="startMode('mitad')" class="menu-card w-full p-6 bg-white border-2 border-gray-100 text-slate-700 rounded-3xl font-bold text-xl hover:border-blue-400 transition-colors">En medio</button>
                    <button onclick="startMode('final')" class="menu-card w-full p-6 bg-white border-2 border-gray-100 text-slate-700 rounded-3xl font-bold text-xl hover:border-blue-400 transition-colors">Al final</button>
                </div>
            `;
        }

        function startMode(pos) {
            currentPosition = pos;
            currentLevel = 0;
            sessionErrors = [];
            showGame();
        }

        function showGame() {
            const data = gameLibrary[currentCategory][currentPosition][currentLevel];
            const posText = currentPosition === "inicio" ? "primera" : currentPosition === "mitad" ? "de en medio" : "Ãºltima";

            viewContainer.innerHTML = `
                <div class="fade-in flex flex-col items-center flex-1 h-full">
                    <div class="w-full flex justify-between items-center mb-2">
                        <button onclick="showPositionMenu()" class="text-gray-400 text-[10px] font-bold uppercase tracking-tighter">â† Salir</button>
                        <div class="flex items-center gap-2">
                             <div class="h-2 w-20 bg-gray-100 rounded-full overflow-hidden">
                                <div class="h-full bg-yellow-400 transition-all duration-300" style="width: ${((currentLevel+1)/20)*100}%"></div>
                             </div>
                             <span class="text-[10px] font-bold text-gray-300">${currentLevel+1}/20</span>
                        </div>
                    </div>

                    <p class="text-gray-600 font-bold text-center mb-4 leading-tight text-sm">
                        Â¿CuÃ¡l es la <span class="text-purple-600">${posText}</span> sÃ­laba?
                    </p>

                    <button id="audio-btn" class="mb-4 p-3 bg-purple-600 text-white rounded-full shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M9.383 3.076A1 1 0 0110 4v12a1 1 0 01-1.707.707L4.586 13H2a1 1 0 01-1-1V8a1 1 0 011-1h2.586l3.707-3.707a1 1 0 011.09-.217z"/>
                        </svg>
                    </button>

                    <div id="image-frame" class="w-32 h-32 sm:w-40 sm:h-40 bg-white rounded-[2.5rem] flex items-center justify-center text-[5.5rem] sm:text-[7rem] shadow-inner border-4 border-white mb-6">
                        ${data.emoji}
                    </div>

                    <div id="word-slots" class="flex gap-2 h-14 items-center mb-8 justify-center">
                        <!-- Slots -->
                    </div>

                    <div class="mt-auto w-full p-4 bg-gray-50 rounded-3xl border border-gray-100">
                        <div id="options-pool" class="flex justify-center gap-3 flex-wrap">
                            <!-- Opciones -->
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('audio-btn').onclick = () => hablar(data.word);

            const slots = document.getElementById('word-slots');
            data.syllables.forEach((syl, i) => {
                if (i === data.targetIdx) {
                    slots.innerHTML += `<div id="drop-target" class="w-14 h-14 border-4 border-dashed border-gray-200 rounded-xl flex items-center justify-center text-xl font-bold text-gray-200 bg-white">?</div>`;
                } else {
                    slots.innerHTML += `<div class="w-14 h-14 border-4 border-gray-50 rounded-xl flex items-center justify-center text-xl font-bold text-gray-400 bg-white/50">${syl}</div>`;
                }
            });

            const pool = document.getElementById('options-pool');
            [...data.options].sort(() => Math.random() - 0.5).forEach(syl => {
                const btn = document.createElement('div');
                btn.className = "syllable-card w-14 h-14 bg-white border-2 border-purple-100 rounded-xl flex items-center justify-center text-xl font-bold text-purple-600 shadow-sm";
                btn.innerText = syl;
                btn.dataset.syl = syl;
                btn.addEventListener('pointerdown', onPointerDown);
                pool.appendChild(btn);
            });
        }

        // --- ARRASTRE ---

        function onPointerDown(e) {
            dragItem = e.currentTarget;
            hablar(dragItem.dataset.syl);
            const rect = dragItem.getBoundingClientRect();
            offset.x = e.clientX - rect.left;
            offset.y = e.clientY - rect.top;
            dragItem.style.position = 'fixed';
            dragItem.style.width = rect.width + 'px';
            dragItem.style.height = rect.height + 'px';
            dragItem.style.left = rect.left + 'px';
            dragItem.style.top = rect.top + 'px';
            dragItem.style.zIndex = '1000';
            dragItem.style.pointerEvents = 'none';
            window.addEventListener('pointermove', onPointerMove);
            window.addEventListener('pointerup', onPointerUp);
        }

        function onPointerMove(e) {
            if (!dragItem) return;
            dragItem.style.left = (e.clientX - offset.x) + 'px';
            dragItem.style.top = (e.clientY - offset.y) + 'px';
            const target = document.getElementById('drop-target');
            const tRect = target.getBoundingClientRect();
            const isOver = !(e.clientX < tRect.left || e.clientX > tRect.right || e.clientY < tRect.top || e.clientY > tRect.bottom);
            target.classList.toggle('drop-zone-active', isOver);
        }

        function onPointerUp(e) {
            window.removeEventListener('pointermove', onPointerMove);
            window.removeEventListener('pointerup', onPointerUp);
            const target = document.getElementById('drop-target');
            if(!target) return;
            const tRect = target.getBoundingClientRect();
            const isOver = !(e.clientX < tRect.left || e.clientX > tRect.right || e.clientY < tRect.top || e.clientY > tRect.bottom);

            const levelData = gameLibrary[currentCategory][currentPosition][currentLevel];

            if (isOver) {
                if (dragItem.dataset.syl === levelData.syllables[levelData.targetIdx]) {
                    target.innerText = dragItem.dataset.syl;
                    target.className = "w-14 h-14 border-4 border-green-500 rounded-xl flex items-center justify-center text-xl font-bold text-green-600 bg-green-50 correct-pop";
                    dragItem.remove();
                    hablar(levelData.word);
                    setTimeout(() => hablar("Â¡Bien hecho!", false), 800);
                    setTimeout(() => {
                        currentLevel++;
                        if (currentLevel < 20) showGame();
                        else showLevelWin();
                    }, 1600);
                } else {
                    sessionErrors.push({ word: levelData.word, correct: levelData.syllables[levelData.targetIdx], failed: dragItem.dataset.syl });
                    dragItem.style.position = 'static';
                    dragItem.style.pointerEvents = 'auto';
                    target.classList.remove('drop-zone-active');
                    hablar("Prueba otra vez", false);
                }
            } else {
                dragItem.style.position = 'static';
                dragItem.style.pointerEvents = 'auto';
            }
            dragItem = null;
        }

        // --- REPORTE ---

        function generateReportText() {
            let text = `INFORME: ${studentName}\n`;
            text += `CategorÃ­a: ${currentCategory.toUpperCase()} (${currentPosition})\n`;
            text += `Aciertos: ${20 - sessionErrors.length}/20\n`;
            text += `Errores (${sessionErrors.length}):\n`;
            sessionErrors.forEach((e, i) => {
                text += `${i+1}. ${e.word}: Puso "${e.failed}" (Era "${e.correct}")\n`;
            });
            return text;
        }

        function showLevelWin() {
            hablar("Â¡Genial! Fase terminada");
            viewContainer.innerHTML = `
                <div class="fade-in flex flex-col h-full text-center">
                    <h2 class="text-2xl font-black text-purple-600 mb-2">Â¡HAS GANADO!</h2>
                    <p class="text-gray-400 text-sm mb-4">Alumno: ${studentName}</p>
                    
                    <div class="bg-gray-50 rounded-2xl p-4 text-left text-xs mb-4 flex-1 overflow-y-auto border border-gray-100 font-mono">
                        ${generateReportText().replace(/\n/g, '<br>')}
                    </div>

                    <div class="space-y-3">
                        <button onclick="copyToClipboard()" class="w-full py-5 bg-emerald-500 text-white rounded-2xl font-bold text-lg shadow-md hover:bg-emerald-600 transition-colors">ğŸ“‹ Copiar Informe</button>
                        <button onclick="showMainMenu()" class="w-full py-4 bg-purple-600 text-white rounded-2xl font-bold hover:bg-purple-700 transition-colors">MenÃº Principal</button>
                    </div>
                </div>
            `;
        }

        function copyToClipboard() {
            const text = generateReportText();
            const tempInput = document.createElement("textarea");
            tempInput.value = text;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand("copy");
            document.body.removeChild(tempInput);
            hablar("Informe copiado al portapapeles. Â¡Ahora puedes pegarlo donde quieras!");
        }

        window.onload = showLogin;
    </script>
</body>
</html>

